- name: Run the equivalent of "apt-get update"
  apt:
     update_cache: yes
  become: true

- name: Create Minio group
  group:
    name: minio
    state: present
  become: true

- name: Create Minio user
  user:
    name: minio
    shell: /bin/bash
    state: present
    group: minio
  become: true


- name: Create the Minio data storage directories
  file:
    path: "/mnt/data"
    state: directory
    owner: minio
    group: minio
    mode: 0750
  become: true

- name: Config Minio
  copy:
      content: |
        MINIO_VOLUMES="/mnt/data"
        MINIO_OPTS="--console-address :9001"
        MINIO_ROOT_USER=minioadmin123
        MINIO_ROOT_PASSWORD=minioadmin123
      dest: "/etc/default/minio"
  become: true

- name: Download Minio
  ansible.builtin.get_url:
    url: https://dl.min.io/server/minio/release/linux-amd64/minio_20241013133411.0.0_amd64.deb
    dest: ~/

- name: Install Minio
  shell: "dpkg -i minio_20241013133411.0.0_amd64.deb"
  become: true

- name: Start Minio
  shell: "systemctl start minio"
  become: true
